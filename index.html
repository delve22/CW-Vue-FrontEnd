<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>After School Activities Store</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <div id="app" class="container mt-4">
        <header class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded">
            <h1 class="h3">ðŸ“š After School Classes</h1>

            <button 
                class="btn btn-warning" 
                @click="showCart = !showCart"
                :disabled="!isCartEnabled" 
                title="Shopping Cart"
            >
                <i class="fas fa-shopping-cart"></i> 
                Cart ({{ cart.length }})
            </button>
        </header>

        <div v-if="!showCart" class="lessons-page">
            <div class="row mb-3 align-items-center">
                <div class="col-md-6">
                    <input 
                        v-model="searchQuery" 
                        @input="handleSearch" 
                        type="text" 
                        class="form-control" 
                        placeholder="Search by topic or location..."
                    >
                </div>
                <div class="col-md-6 d-flex align-items-center">
                    <label for="sort-by" class="me-2 text-nowrap">Sort By:</label>
                    <select v-model="sortBy" id="sort-by" class="form-select me-2">
                        <option value="subject">Subject</option>
                        <option value="location">Location</option>
                        <option value="price">Price</option>
                        <option value="space">Spaces</option>
                    </select>
                    <button class="btn btn-outline-secondary" @click="sortOrder = sortOrder === 'asc' ? 'desc' : 'asc'">
                        <i class="fas" :class="{'fa-arrow-up': sortOrder === 'asc', 'fa-arrow-down': sortOrder === 'desc'}"></i>
                    </button>
                </div>
            </div>

            <div class="row">
                <div v-for="lesson in sortedLessons" :key="lesson._id" class="col-md-4 mb-4">
                    <div class="card h-100 shadow-sm">
                        <img :src="getLessonImageUrl(lesson.image)" class="card-img-top" alt="Lesson Icon">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title">{{ lesson.topic }}</h5>
                            <p class="card-text">
                                <strong>Location:</strong> {{ lesson.location }}<br>
                                <strong>Price:</strong> Â£{{ lesson.price }}<br>
                                <strong :class="{'text-danger': lesson.space === 0}">Spaces:</strong> {{ lesson.space }}
                            </p>

                            <button 
                                class="btn mt-auto" 
                                :class="{'btn-primary': lesson.space > 0, 'btn-secondary': lesson.space === 0}"
                                :disabled="lesson.space === 0"
                                @click="addToCart(lesson)"
                            >
                                <i class="fas fa-cart-plus"></i> Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-else class="cart-page">
            <h2>ðŸ›’ Shopping Cart</h2>
            <div v-if="cart.length === 0" class="alert alert-info">
                Your cart is empty.
            </div>
            <div v-else class="row">
                <div class="col-md-7">
                    <ul class="list-group mb-3">
                        <li v-for="(item, index) in cart" :key="index" class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">{{ item.topic }} in {{ item.location }}</h6>
                                <small class="text-muted">Price: Â£{{ item.price }}</small>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-danger" @click="removeFromCart(item, index)">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="col-md-5">
                    <div class="card p-3 shadow-sm">
                        <h4 class="mb-3">Checkout Details</h4>
                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" v-model="checkout.name" class="form-control" id="name" placeholder="Full Name">
                            <small v-if="!isNameValid && checkout.name.length > 0" class="text-danger">Name must contain letters only.</small>
                        </div>
                        <div class="mb-3">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input type="text" v-model="checkout.phone" class="form-control" id="phone" placeholder="Phone Number">
                            <small v-if="!isPhoneValid && checkout.phone.length > 0" class="text-danger">Phone must contain numbers only.</small>
                        </div>

                        <button 
                            class="btn btn-success mt-3" 
                            :disabled="!isCheckoutEnabled" 
                            @click="submitOrder"
                        >
                            Place Order
                        </button>

                        <div v-if="orderMessage" class="alert mt-3" :class="orderMessage.type">
                            {{ orderMessage.text }}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.16/dist/vue.js"></script>
    <script src="app.js"></script>
</body>
</html>